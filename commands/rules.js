const { sendMessage, removeMessage } = require('../helpers/message');
const { homeOption } = require('../const/dictionary');

const moduleActionName = 'rules';
const startActionName = 'start';
const chatSectionName = 'chat';
const silentSectionName = 'silent';

const startAction = async (ctx, bot, needAnswer) => {
    const messageText =
        'üìö –ü—Ä–∞–≤–∏–ª–∞\n\n' +
        '–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Å–æ–±—Ä–∞–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞.\n' +
        '–î–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å —Ç–µ–∫—Å—Ç–∞–º–∏ –ø—Ä–∞–≤–∏–ª –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ.';

    const buttons = {
        [`${moduleActionName}:${chatSectionName}`]: '–ü—Ä–∞–≤–∏–ª–∞ —á–∞—Ç–∞',
        [`${moduleActionName}:${silentSectionName}`]: '–†–µ–∂–∏–º —Ç–∏—à–∏–Ω—ã',
    };

    await sendMessage(ctx, {
        text: messageText,
        buttons: {
            ...buttons,
            ...homeOption,
        },
    });

    await removeMessage(ctx);

    if (needAnswer) {
        await ctx.answerCbQuery();
    }
};


const sectionSelectHandler = async (ctx, sectionName) => {
    let text = '';
    const buttons = {
        [`${moduleActionName}_${startActionName}`]: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥',
        ...homeOption,
    };

    if (sectionName === chatSectionName) {
        text =
            'üìñ –ü—Ä–∞–≤–∏–ª–∞ —á–∞—Ç–∞\n\n' +
            '–í —Ü–µ–ª—è—Ö –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã –≤–∑–∞–∏–º–Ω–æ–≥–æ —É–≤–∞–∂–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –≥—Ä—É–ø–ø—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è –∏ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã –º–µ—Ä—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –∏—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–µ. –í –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –º–æ–≥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –º–µ—Ä—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.\n\n' +
            '<b>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, –≤ —Ç–æ–º —á–∏—Å–ª–µ, –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö:</b>\n' +
            '‚ùó—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤;\n' +
            '‚ùó—Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö, –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –∞–∫—Ü–∏–π –∏ –∏–Ω–æ–≥–æ —Å–ø–∞–º–∞;\n' +
            '‚ùóÔ∏è–ø—Ä–∏–∑—ã–≤—ã –∫ –ø—Ä–æ—Ç–∏–≤–æ–ø—Ä–∞–≤–Ω—ã–º –¥–µ–π—Å—Ç–≤–∏—è–º;\n' +
            '‚ùóÔ∏è–ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ –Ω–µ—É–≤–∞–∂–µ–Ω–∏—è, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π –∏–ª–∏ –∞–≥—Ä–µ—Å—Å–∏–∏ –≤ –∞–¥—Ä–µ—Å —á–ª–µ–Ω–æ–≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞;\n' +
            '‚ùóÔ∏è—É–º—ã—à–ª–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–µ–∑–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–∏ –ø–∞–Ω–∏–∫–∏.\n\n' +
            '–°—Ä–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –∏ —Ç—è–∂–µ—Å—Ç–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏ –º–æ–∂–µ—Ç —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –æ—Ç 24 —á–∞—Å–æ–≤ –¥–æ –±–µ—Å—Å—Ä–æ—á–Ω–æ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ —á–∞—Ç–∞.\n\n' +
            '<b>–ü—Ä–æ—Å–∏–º –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å–æ–±–ª—é–¥–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É.</b>';
    }

    if (sectionName === silentSectionName) {
        text =
            'üìñ <a href="https://www.consultant.ru/cons/cgi/online.cgi?from=99521-25&req=doc&base=SPB&n=319748">–†–µ–∂–∏–º —Ç–∏—à–∏–Ω—ã </a>\n\n' +
            '<b>–í –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ —à—É–º–µ—Ç—å:</b>\n' +
            '‚Ä¢ —Å 22:00 –¥–æ 08:00 –≤ –±—É–¥–Ω–∏–µ –¥–Ω–∏;\n' +
            '‚Ä¢ —Å 22:00 –¥–æ 12:00 –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ –∏ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏.\n\n' +
            '–ö —à—É–º—É –æ—Ç–Ω–æ—Å—è—Ç—Å—è –≥—Ä–æ–º–∫–∞—è –º—É–∑—ã–∫–∞, –∫—Ä–∏–∫–∏, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–≤—É–∫–æ—É—Å–∏–ª–∏–≤–∞—é—â–µ–π —Ç–µ—Ö–Ω–∏–∫–∏, —Ä–µ–º–æ–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –∏ –¥—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è, –Ω–∞—Ä—É—à–∞—é—â–∏–µ –ø–æ–∫–æ–π –≥—Ä–∞–∂–¥–∞–Ω.\n\n' +
            '<b>–†–µ–º–æ–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã:</b>\n' +
            '‚Ä¢ —Å 09:00 –¥–æ 19:00\n' +
            '‚Ä¢ —Å –ø–µ—Ä–µ—Ä—ã–≤–æ–º —Å 13:00 –¥–æ 15:00\n\n' +
            '<b>–ü—Ä–æ—Å–∏–º —Å —É–≤–∞–∂–µ–Ω–∏–µ–º –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É!</b>\n\n';
    }

    await sendMessage(ctx, {
        text,
        buttons,
    });

    await removeMessage(ctx);

    await ctx.answerCbQuery();
}

const callbackHandler = async (ctx, next) => {
    const data = ctx.callbackQuery.data;
    const [action, sectionName] = data.split(':');

    if (action === moduleActionName) {
        await sectionSelectHandler(ctx, sectionName);
    }

    return next();
};


module.exports = (bot) => {
    bot.command(`${moduleActionName}_${startActionName}`, async (ctx) => startAction(ctx, bot));
    bot.action(`${moduleActionName}_${startActionName}`, async (ctx) => startAction(ctx, bot, true));
    bot.on('callback_query', async (ctx, next) => callbackHandler(ctx, next));
};
